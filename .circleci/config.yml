# Root CircleCI configuration
# Configuration for individual packages lives in .circleci/src/{commands,jobs,workflows}

version: 2.1

jobs:
  sample-test-job:
    parameters:
      service:
        description: "Service to test"
        type: string
    machine:
      image: ubuntu-2204:current
      docker_layer_caching: true
    resource_class: large
    steps:
      - run: docker images -a
      - checkout:
          path: '~/audius-protocol'
      - run: AUDIUS_DEV=false bash ~/audius-protocol/dev-tools/setup.sh
      - run:
          name: test run "<< parameters.service >>"
          no_output_timeout: 20m
          command: . ~/.profile; audius-compose test run "<< parameters.service >>"
      - run: docker images -a
      - run: docker image ls --digests

workflows:
  test-workflow:
    jobs:
      - sample-test-job:
          service: discovery-provider
