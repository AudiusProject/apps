resource_class: small
docker:
  - image: cimg/base:2023.01
steps:
  - checkout
  - run:
      name: Create branch
      command: |
        OLD_VERSION=$(jq -r .version discovery-provider/.version.json)
        NEW_VERSION=$(echo ${NEW_VERSION} | awk -F. '{$NF = $NF + 1;} 1' | sed 's/ /./g')

        git branch "release-v$NEW_VERSION"
        git checkout "release-v$NEW_VERSION"

        jq --arg version "$NEW_VERSION" '.version=$version' creator-node/.version.json > /tmp/.version.json
        mv /tmp/.version.json creator-node/.version.json
        git add creator-node/.version.json

        jq --arg version "$NEW_VERSION" '.version=$version' discovery-provider/.version.json > /tmp/.version.json
        mv /tmp/.version.json discovery-provider/.version.json
        git add discovery-provider/.version.json

        git commit -m "Bump version to $NEW_VERSION"

        git push --set-upstream origin "release-v$NEW_VERSION"
