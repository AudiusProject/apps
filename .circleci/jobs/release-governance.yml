docker:
  - image: cimg/node:14.16
steps:
  - checkout

  - restore_cache:
      keys:
        - sdk-cache-{{ checksum "libs/package-lock.json" }}
        - sdk-cache-
  - run:
      name: Install sdk
      command: |
        cd libs
        npm install
        npm run build:sdk
  - save_cache:
      key: sdk-cache-{{ checksum "libs/package-lock.json" }}
      paths:
        - ./libs/node_modules

  - run:
      name: Governance Release
      command: |
        export RELEASE_VERSION="$(jq -r .version discovery-provider/.version.json)"

        cd libs
        node scripts/release-governance.js
