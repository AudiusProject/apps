lint-discovery:
  working_directory: ~/audius-protocol
  docker:
    - image: cimg/python:3.11
  steps:
    - checkout

    - restore_cache:
        key: python-requirements-{{ checksum "discovery/requirements.txt" }}

    - run:
        name: Install Python dependencies
        command: |
          cd discovery
          pip install -r requirements.txt

    - save_cache:
        key: python-requirements-{{ checksum "discovery/requirements.txt" }}
        paths:
          - '~/.cache/pip'
          - '/usr/local/lib/python3.11/site-packages'
          - '/usr/local/lib/site-python'

    - run:
        name: Lint
        command: |
          cd discovery
          isort .
          flake8 .
          black .

    - run:
        name: Typecheck
        command: |
          cd discovery
          mypy .
