uptime-init:
  working_directory: ~/audius-protocol
  docker:
    - image: cimg/ruby:2.6-node
  
  steps:
    - checkout

    - run: echo "//registry.npmjs.org/:_authToken=${NPM_AUTH_TOKEN}" > monitoring/uptime/node-ui/.npmrc

    # Download and cache dependencies
    - restore_cache:
        keys:
          - dependency-cache-{{ checksum "monitoring/uptime/node-ui/package.json" }}
          # fallback to using the latest cache if no exact match is found
          - dependency-cache-

    - run:
        name: npm ci
        command: |
          cd monitoring/uptime/node-ui
          npm ci

    - save_cache:
        key: dependency-cache-{{ checksum "monitoring/uptime/node-ui/package.json" }}
        paths:
          - monitoring/uptime/node-ui/node_modules

    # Lint
    - run:
        name: d lint
        command: |
          cd monitoring/uptime/node-ui
          npm run lint

    # Persist node modules
    - persist_to_workspace:
        root: ./
        paths:
          - monitoring/uptime/node-ui/node_modules
