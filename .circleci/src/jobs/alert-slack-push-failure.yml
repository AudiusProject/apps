working_directory: ~/audius-protocol
resource_class: small
docker:
  - image: cimg/base:2023.01
steps:
  - checkout
  - add_ssh_keys:
      fingerprints:
        - 'd0:0b:a0:19:ac:46:58:e4:6c:ac:34:99:f6:1b:31:bb' # github.com
  - run:
      name: Alert Slack of failure
      command: |
        json_content="{ \"blocks\": ["
        json_content+="\"type\": \"section\","
        json_content+="\"text\": { \"type\": \"mrkdwn\", \"text\": \"Building and pushing artifacts for today's release failed. Please check the release branch in CircleCI.\" }"
        json_content+="}]}"
        echo "Sending error message to Slack: $json_content"

        curl -f -X POST -H 'Content-type: application/json' \
        --data "$json_content" \
        $SLACK_DAILY_DEPLOY_WEBHOOK
