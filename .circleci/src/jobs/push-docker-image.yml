parameters:
  service:
    description: 'Service to push'
    type: string
resource_class: large
machine:
  image: ubuntu-2204:current
  docker_layer_caching: true
steps:
  - checkout:
      path: '~/audius-protocol'
  - run: AUDIUS_DEV=false bash ~/audius-protocol/dev-tools/setup.sh
  - run:
      name: Docker login
      command: echo "$DOCKERHUB_PASS" | docker login -u "$DOCKERHUB_USERNAME" --password-stdin
  - run: . ~/.profile; audius-compose build --prod "<< parameters.service >>"
  - run: . ~/.profile; audius-compose push --prod "<< parameters.service >>"
