version: '3'

services:

  ingress:
    container_name: ingress
    extends:
      file: docker-compose.v2.base.yml
      service: nginx
    volumes:
      - ./v2_nginx/ingress.conf:/etc/nginx/conf.d/default.conf
    ports:
      - 80:80

  comdb:
    container_name: comdb
    extends:
      file: docker-compose.v2.base.yml
      service: comdb

  com1:
    container_name: com1
    extends:
      file: docker-compose.v2.base.yml
      service: nats-dev
    environment:
      audius_discprov_env: standalone # TODO: remove (keeping for now to make sure the standalone code path is still working)
      AUDIUS_DELEGATE_PRIVATE_KEY: "293589cdf207ed2f2253bb72b17bb7f2cfe399cdc34712b1d32908d969682238" # Public key: "0x1c185053c2259f72fd023ED89B9b3EBbD841DA0F"
      test_host: "com1"

  storage1:
    container_name: storage1
    extends:
      file: docker-compose.v2.base.yml
      service: storage-dev
    environment:
      audius_discprov_env: standalone # TODO: remove (keeping for now to make sure the standalone code path is still working)
      AUDIUS_DELEGATE_PRIVATE_KEY: "293589cdf207ed2f2253bb72b17bb7f2cfe399cdc34712b1d32908d969682238" # Public key: "0x1c185053c2259f72fd023ED89B9b3EBbD841DA0F"
      NATS_SERVER_URL: "nats://com1:4222" # TODO: remove when 'standalone' goes away
      NAME: "storage1"
      test_host: "com1"
    depends_on:
      - com1
    volumes:
      - ./:/app
