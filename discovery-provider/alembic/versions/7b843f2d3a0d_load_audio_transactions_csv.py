"""load audio transactions csv

Revision ID: 7b843f2d3a0d
Revises: 21e5635c83a9
Create Date: 2022-12-05 20:30:57.288526

"""
import os
from pathlib import Path

import sqlalchemy as sa
from alembic import op

# revision identifiers, used by Alembic.
revision = "7b843f2d3a0d"
down_revision = "21e5635c83a9"
branch_labels = None
depends_on = None


def upgrade():
    env = os.getenv("audius_discprov_env")
    if env == "stage":
        pass

    connection = op.get_bind()
    query = """
        delete from audio_transactions_history where slot < 164000000;
    """
    connection.execute(query)

    cursor = connection.connection.cursor()
    for i in range(4):
        path = Path(__file__).parent.joinpath(f"../tmp/audio_transactions_history0{i}")
        f = open(path, "r")
        cursor.copy_from(f, "audio_transactions_history", sep=",")
        f.close()


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###
