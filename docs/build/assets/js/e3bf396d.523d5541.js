"use strict";(self.webpackChunkdocs_audius_org=self.webpackChunkdocs_audius_org||[]).push([[6074],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=u(n),m=i,c=h["".concat(l,".").concat(m)]||h[m]||d[m]||o;return n?a.createElement(c,r(r({ref:t},p),{},{components:n})):a.createElement(c,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var u=2;u<o;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8155:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var a=n(7462),i=(n(7294),n(3905));const o={sidebar_label:"Log In with Audius",sidebar_position:4},r="Log In with Audius",s={unversionedId:"developers/log-in-with-audius",id:"developers/log-in-with-audius",title:"Log In with Audius",description:"Log In with Audius lets you retrieve and verify a user's Audius profile information without making the user give you their Audius password.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/developers/log-in-with-audius.md",sourceDirName:"developers",slug:"/developers/log-in-with-audius",permalink:"/developers/log-in-with-audius",draft:!1,editUrl:"https://github.com/AudiusProject/docs.audius.org/docs/developers/log-in-with-audius.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_label:"Log In with Audius",sidebar_position:4},sidebar:"sidebar",previous:{title:"GetTrendingTracksTimeEnum",permalink:"/developers/sdk/enums/GetTrendingTracksTimeEnum"}},l={},u=[{value:"Quickstart",id:"quickstart",level:2},{value:"Examples",id:"examples",level:2},{value:"Full Reference",id:"full-reference",level:2},{value:"1. Install the JavaScript SDK",id:"1-install-the-javascript-sdk",level:3},{value:"2. Initialize the SDK <code>oauth</code> feature",id:"2-initialize-the-sdk-oauth-feature",level:3},{value:"3. Render the Log In button",id:"3-render-the-log-in-button",level:3},{value:"4. Optional: Show loader until the button is ready",id:"4-optional-show-loader-until-the-button-is-ready",level:3},{value:"5. Done!",id:"5-done",level:3},{value:"Example use cases",id:"example-use-cases",level:2},{value:"Authentication, not authorization",id:"authentication-not-authorization",level:3},{value:"Workflow",id:"workflow",level:2},{value:"Manual Implementation",id:"manual-implementation",level:2},{value:"1. Open the Log In with Audius prompt page",id:"1-open-the-log-in-with-audius-prompt-page",level:3},{value:"2. Receive the response",id:"2-receive-the-response",level:3},{value:"<strong>If you used a redirect URI</strong>:",id:"if-you-used-a-redirect-uri",level:4},{value:"<strong>If you used <code>redirectURI=postmessage</code></strong>:",id:"if-you-used-redirecturipostmessage",level:4},{value:"3. Verify the response",id:"3-verify-the-response",level:3},{value:"3. Done!",id:"3-done",level:4},{value:"A quick note on email",id:"a-quick-note-on-email",level:4}],p={toc:u};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"log-in-with-audius"},"Log In with Audius"),(0,i.kt)("center",null,(0,i.kt)("img",{src:"/img/oauthpopup.png",height:"488",width:"252",alt:"Log In with Audius popup"})),(0,i.kt)("p",null,"Log In with Audius lets you retrieve and verify a user's Audius profile information without making the user give you their Audius password."),(0,i.kt)("h2",{id:"quickstart"},"Quickstart"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="index.html"',title:'"index.html"'},'<div id="audiusLogInButton"></div>\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="script.js" showLineNumbers',title:'"script.js"',showLineNumbers:!0},'import Web3 from "web3";\nimport { sdk } from "@audius/sdk";\n\nwindow.Web3 = Web3\n\nconst audiusSdk = sdk({ appName: "Name of your app goes here" });\n\naudiusSdk.oauth.init((res) => {\n  console.log("Log in success!", res);\n});\n\naudiusSdk.oauth.renderButton(document.getElementById("audiusLogInButton"));\n')),(0,i.kt)("h2",{id:"examples"},"Examples"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Demo with React - ",(0,i.kt)("a",{parentName:"li",href:"https://j2jx6f.csb.app/"},"Demo app")," | ",(0,i.kt)("a",{parentName:"li",href:"https://codesandbox.io/s/log-in-with-audius-demo-j2jx6f?file=/src/App.js"},"Code")),(0,i.kt)("li",{parentName:"ul"},"Demo with vanilla JS - ",(0,i.kt)("a",{parentName:"li",href:"https://xkogl3.csb.app/"},"Demo app")," | ",(0,i.kt)("a",{parentName:"li",href:"https://codesandbox.io/s/log-in-with-audius-demo-vanilla-js-xkogl3?file=/index.html"},"Code")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://9ncjui.csb.app/"},"Log In Button Generator"))),(0,i.kt)("h2",{id:"full-reference"},"Full Reference"),(0,i.kt)("h3",{id:"1-install-the-javascript-sdk"},"1. Install the JavaScript SDK"),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you are not able to use the JavaScript SDK (for example, if you are developing a mobile app), skip to ",(0,i.kt)("a",{parentName:"p",href:"#manual-implementation"},"Manual Implementation"),"."))),(0,i.kt)("p",null,"In your terminal, run the following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install web3 @audius/sdk\n")),(0,i.kt)("p",null,"Then, initialize the SDK:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import Web3 from "web3";\nimport { sdk } from "@audius/sdk";\n\nwindow.Web3 = Web3;\nconst audiusSdk = sdk({ appName: "Name of your app goes here" });\n')),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"See complete instructions ",(0,i.kt)("a",{parentName:"p",href:"developers/sdk/index#installation"},"here")," to install and initialize the JavaScript SDK."))),(0,i.kt)("h3",{id:"2-initialize-the-sdk-oauth-feature"},"2. Initialize the SDK ",(0,i.kt)("inlineCode",{parentName:"h3"},"oauth")," feature"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"showLineNumbers",showLineNumbers:!0},'audiusSdk.oauth.init(\n  (res) => {\n    // This will run if the user logged in successfully.\n    console.log("Log in success!", res);\n    /**\n     `res` will contain the following user information:\n      {\n        userId: number; // unique Audius user identifier\n        email: string;\n        name: string; // user\'s display name\n        handle: string;\n        verified: boolean; // whether the user has the Audius "verified" checkmark\n        profilePicture: {"150x150": string, "480x480": string, "1000x1000": string } | null // URLs for the user\'s profile picture\n        sub: number; // alias for userId\n        iat: string; // timestamp for when auth was performed\n      }\n    **/\n  },\n  (err) => {\n    // This will run if there was an error during the auth flow.\n    console.log("Error :(", err);\n    // `err` will contain the error message\n  }\n);\n')),(0,i.kt)("h3",{id:"3-render-the-log-in-button"},"3. Render the Log In button"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="In your JS" showLineNumbers',title:'"In',your:!0,'JS"':!0,showLineNumbers:!0},'audiusSdk.oauth.renderButton(document.getElementById("audiusLogInButton"), {\n  size: "large",\n  corners: "pill",\n  customText: "Continue with Audius",\n});\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="In your HTML"',title:'"In',your:!0,'HTML"':!0},'<div id="audiusLogInButton"></div>\n')),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"sdk-oauth-methods#oauthrenderbuttonelement-customizations"},(0,i.kt)("inlineCode",{parentName:"a"},"renderButton"))," replaces the element passed in the first parameter with the Log In with Audius button."),(0,i.kt)("p",null,"The second parameter passed to ",(0,i.kt)("inlineCode",{parentName:"p"},"renderButton")," is an optional object with customization settings for the button."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You can use ",(0,i.kt)("a",{parentName:"p",href:"https://9ncjui.csb.app/"},"this playground")," to see how these customizations affect the button appearance and determine what config works best for your app!"))),(0,i.kt)("p",null,"If you don't want to use ",(0,i.kt)("inlineCode",{parentName:"p"},"renderButton"),", you can implement a login button yourself and invoke the login popup with ",(0,i.kt)("a",{parentName:"p",href:"sdk-oauth-methods#oauthlogin"},(0,i.kt)("inlineCode",{parentName:"a"},"audiusSdk.oauth.login()")),"."),(0,i.kt)("h3",{id:"4-optional-show-loader-until-the-button-is-ready"},"4. Optional: Show loader until the button is ready"),(0,i.kt)("p",null,"The button may take up to a couple of seconds to load. You may want to show a loading indicator until the button has loaded for an optimal user experience."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="In your HTML" showLineNumbers',title:'"In',your:!0,'HTML"':!0,showLineNumbers:!0},'\x3c!-- Surround your element that will be replaced with the Log In with Audius button with a parent, e.g.: --\x3e\n<div id="parent">\n  <div id="audiusLogInButton"></div>\n  <div id="loading">Loading...</div>\n</div>\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript",metastring:'title="In your JS" showLineNumbers',title:'"In',your:!0,'JS"':!0,showLineNumbers:!0},'const observer = new MutationObserver(function (mutations_list) {\n  mutations_list.forEach(function (mutation) {\n    mutation.addedNodes.forEach(function (added_node) {\n      if (added_node.id == "audius-login-button") {\n        // Login button has rendered\n        document.querySelector("#loading").remove();\n        observer.disconnect();\n      }\n    });\n  });\n});\n\nobserver.observe(document.querySelector("#parent"), {\n  subtree: false,\n  childList: true,\n});\n')),(0,i.kt)("p",null,"The log in button will be rendered with an id of ",(0,i.kt)("inlineCode",{parentName:"p"},"audius-login-button"),". As shown above, you can detect when the element has been added using a MutationObserver."),(0,i.kt)("h3",{id:"5-done"},"5. Done!"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"#examples"},"See examples")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"sdk-oauth-methods"},"Read full SDK ",(0,i.kt)("inlineCode",{parentName:"a"},"oauth")," docs")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("h3",{parentName:"div",id:"retrieving-email-addresses"},"Retrieving email addresses"),(0,i.kt)("p",{parentName:"div"},"Once you know your user's Audius user id, you can retrieve their Audius information at any time using our SDK or web APIs. However, the one piece of profile information that is not available outside of the Log In with Audius response is the user's email address. If you do not initially store the user's email address, you can only re-retrieve the email through having the user re-complete the Log In with Audius flow."))),(0,i.kt)("h2",{id:"example-use-cases"},"Example use cases"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Provide a convenient way for users to sign up and/or log in to your app without having to set a password or fill in a profile form"),(0,i.kt)("li",{parentName:"ul"},"Associate a user to their Audius account so that you can retrieve their Audius data (e.g. retrieve their tracks)"),(0,i.kt)("li",{parentName:"ul"},'Confirm if a user is a "Verified" Audius artist')),(0,i.kt)("p",null,"However, note that this flow ",(0,i.kt)("strong",{parentName:"p"},"CANNOT"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Manage the user's login session on your app"),(0,i.kt)("li",{parentName:"ul"},"Grant your app permission to perform actions on Audius on the user's behalf (see more below)")),(0,i.kt)("h3",{id:"authentication-not-authorization"},"Authentication, not authorization"),(0,i.kt)("p",null,"Log in With Audius is able to provide authentication, but not authorization (yet!). In other words, this flow does not enable you to perform actions on the user's behalf (for example, upload a track)."),(0,i.kt)("h2",{id:"workflow"},"Workflow"),(0,i.kt)("p",null,'The "Log In with Audius" flow looks like this:'),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"You provide a button on your app or website to begin the authentication flow"),(0,i.kt)("li",{parentName:"ol"},"When the user clicks the button, it opens the Log In with Audius page"),(0,i.kt)("li",{parentName:"ol"},"Once the user successfully signs in, Audius provides your app/website with the user profile using a JSON Web Token (JWT)"),(0,i.kt)("li",{parentName:"ol"},"Your app verifies and decodes the JWT")),(0,i.kt)("p",null,"The JWT payload contains the following information about the user:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Unique identifier (Audius user id)"),(0,i.kt)("li",{parentName:"ul"},"Email"),(0,i.kt)("li",{parentName:"ul"},"Display name"),(0,i.kt)("li",{parentName:"ul"},"Audius handle"),(0,i.kt)("li",{parentName:"ul"},"Whether the user is a verified artist (i.e. has a purple checkmark)"),(0,i.kt)("li",{parentName:"ul"},"Profile picture URL")),(0,i.kt)("h2",{id:"manual-implementation"},"Manual Implementation"),(0,i.kt)("p",null,"If you are not able to use the Audius JavaScript SDK, you may implement Log In with Audius manually by following the steps below."),(0,i.kt)("h3",{id:"1-open-the-log-in-with-audius-prompt-page"},"1. Open the Log In with Audius prompt page"),(0,i.kt)("p",null,'Create a "Log In with Audius" button on your app.'),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If using HTML (or HTML-like markup) and CSS, check out ",(0,i.kt)("a",{parentName:"p",href:"https://j2jx6f.csb.app/"},"this playground")," to easily customize and generate code for an Audius-branded login button."))),(0,i.kt)("p",null,"Clicking your log in button should direct the user to the Log In with Audius prompt page."),(0,i.kt)("p",null,"On a native app, the log in button should open a secure web browser within the app that loads the Audius login page. A web app should open the Audius login page in a popup or redirect to it."),(0,i.kt)("p",null,"The Log In with Audius prompt page is located at the following URL:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"https://audius.co/oauth/auth?scope=read&app_name={YourAppName}&redirect_uri={YourRedirectURI}&origin={YourAppOrigin}&state={YourStateValue}&response_mode={query|fragment}")),(0,i.kt)("p",null,"You must open this page with the required URL parameters, described below."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Params")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"scope ",(0,i.kt)("inlineCode",{parentName:"p"},'"read"')," - the scope of the authentication request. Only ",(0,i.kt)("inlineCode",{parentName:"p"},'"read"')," is available (i.e. don't change this).")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"app_name ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," - the name of your app. This will be displayed to the user in the log in prompt page.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"redirect_uri ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," - the location that the Audius login page should redirect to once the user successfully authenticates. Custom URL schemes are allowed and supported. You can use the special value ",(0,i.kt)("inlineCode",{parentName:"p"},"postmessage")," here if you would like the login page to send the response back to its opener using ",(0,i.kt)("inlineCode",{parentName:"p"},"window.postMessage")," instead of using a redirect. Otherwise, the following validation rules apply:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Hosts cannot be raw IP addresses UNLESS they are localhost IP addresses"),(0,i.kt)("li",{parentName:"ul"},"Cannot contain the fragment component (",(0,i.kt)("inlineCode",{parentName:"li"},"#"),")"),(0,i.kt)("li",{parentName:"ul"},"Cannot contain the ",(0,i.kt)("inlineCode",{parentName:"li"},"userinfo")," component"),(0,i.kt)("li",{parentName:"ul"},"Cannot contain a path traversal (contain ",(0,i.kt)("inlineCode",{parentName:"li"},"/..")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"\\.."),")"),(0,i.kt)("li",{parentName:"ul"},"Must contain valid characters and URI format"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"origin ",(0,i.kt)("em",{parentName:"p"},"optional")," ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," - only applicable and required if ",(0,i.kt)("inlineCode",{parentName:"p"},"redirect_uri")," is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"postmessage"),". If so, this value should be set to the ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/URL/origin"},"origin")," of the window that opened the Log In with Audius popup.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"state ",(0,i.kt)("em",{parentName:"p"},"optional but highly recommended")," ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," - any string. When the user is redirected back to your app, the exact ",(0,i.kt)("inlineCode",{parentName:"p"},"state")," value you provide here will be included in the redirect (in the ",(0,i.kt)("inlineCode",{parentName:"p"},"state")," URI fragment parameter). ",(0,i.kt)("strong",{parentName:"p"},"This field should be leveraged as a CSRF protection mechanism")," (read more ",(0,i.kt)("a",{parentName:"p",href:"https://auth0.com/docs/secure/attack-protection/state-parameters"},"here")," or ",(0,i.kt)("a",{parentName:"p",href:"https://security.stackexchange.com/questions/20187/oauth2-cross-site-request-forgery-and-state-parameter"},"here"),"), and may also be used as a way to persist any useful data for your app between where the ",(0,i.kt)("inlineCode",{parentName:"p"},"state")," value is generated and where the redirect goes.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"response_mode")," ",(0,i.kt)("em",{parentName:"p"},"optional, not recommended when possible")," ",(0,i.kt)("inlineCode",{parentName:"p"},'"fragment" | "query"'),' - specifies whether the auth flow response parameters will be encoded in the query string or the fragment component of the redirect_uri when redirecting back to your app. Default behavior is equivalent to "fragment". We recommend NOT changing this if possible.'))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html",metastring:"noInline",noInline:!0},'<a\n  href="https://audius.co/oauth/auth?scope=read&app_name=My%20Demo%20App&redirect_uri=https://mydemoapp.com/oauth/receive-token&state=a4e0761e-8c21-4e20-819d-5a4daeab4ea9"\n  >Click me to log in with Audius!</a\n>\n')),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Remember to handle early exiting (i.e. failure) of the authentication flow"),(0,i.kt)("p",{parentName:"div"},"If the user exits the authentication flow before completing it--e.g. by closing the window--your app should detect this and have the UI respond accordingly."))),(0,i.kt)("h3",{id:"2-receive-the-response"},"2. Receive the response"),(0,i.kt)("h4",{id:"if-you-used-a-redirect-uri"},(0,i.kt)("strong",{parentName:"h4"},"If you used a redirect URI"),":"),(0,i.kt)("p",null,"When the user has successfully authenticated, the Log In with Audius page will redirect to the redirect URI that you specified, ",(0,i.kt)("strong",{parentName:"p"},"with 1) the JWT containing the user profile, and 2) the original state value you provided (if any) included in the URI fragment")," (or query string, if ",(0,i.kt)("inlineCode",{parentName:"p"},"response_mode")," was set to ",(0,i.kt)("inlineCode",{parentName:"p"},"query"),"). To illustrate, going off the example above where we opened the login page with the following URL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-noInline"},"https://audius.co/oauth/auth?scope=read&app_name=My%20Demo%20App&redirect_uri=https://mydemoapp.com/oauth/receive-token&state=a4e0761e-8c21-4e20-819d-5a4daeab4ea9\n")),(0,i.kt)("p",null,"when the user successsfully authenticates, the login page would redirect to:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"https://mydemoapp.com/oauth/receive-token#state=a4e0761e-8c21-4e20-819d-5a4daeab4ea9&token={JWT}")),(0,i.kt)("p",null,"where ",(0,i.kt)("inlineCode",{parentName:"p"},"{JWT}")," is a ",(0,i.kt)("a",{parentName:"p",href:"https://jwt.io/introduction"},"JSON web token")," containing the user's encoded profile information and a signature."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you specified ",(0,i.kt)("inlineCode",{parentName:"p"},"response_mode=query")," when opening the login page, the login page would instead redirect to...:"),(0,i.kt)("p",{parentName:"div"},(0,i.kt)("inlineCode",{parentName:"p"},"https://mydemoapp.com/oauth/receive-token?state=a4e0761e-8c21-4e20-819d-5a4daeab4ea9&token={JWT}")))),(0,i.kt)("p",null,"Skip to ",(0,i.kt)("a",{parentName:"p",href:"#handling-the-response"},(0,i.kt)("strong",{parentName:"a"},"Handling the response"))," below for what to do next."),(0,i.kt)("h4",{id:"if-you-used-redirecturipostmessage"},(0,i.kt)("strong",{parentName:"h4"},"If you used ",(0,i.kt)("inlineCode",{parentName:"strong"},"redirectURI=postmessage")),":"),(0,i.kt)("p",null,"When the user has successfully authenticated, the Log In with Audius page will send a message via ",(0,i.kt)("inlineCode",{parentName:"p"},"window.postMessage")," to the window that opened it. The message will contain a JWT containing the user profile as well as whatever ",(0,i.kt)("inlineCode",{parentName:"p"},"state")," value you originally specified in the corresponding URL param, if any."),(0,i.kt)("p",null,"For instance, if your app opened the login page using the following URL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-noInline"},"https://audius.co/oauth/auth?scope=read&app_name=My%20Demo%20App&redirect_uri=https://mydemoapp.com/oauth/receive-token&state=a4e0761e-8c21-4e20-819d-5a4daeab4ea9\n")),(0,i.kt)("p",null,"the message would look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"{\n  token: <JWT>,\n  state: 'a4e0761e-8c21-4e20-819d-5a4daeab4ea9'\n}\n")),(0,i.kt)("p",null,"where ",(0,i.kt)("inlineCode",{parentName:"p"},"<JWT>")," is a ",(0,i.kt)("a",{parentName:"p",href:"https://jwt.io/introduction"},"JSON web token")," containing the user's encoded profile information and a signature."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Make sure that your ",(0,i.kt)("inlineCode",{parentName:"p"},"postMessage")," event listener validates that the origin of the incoming event is ",(0,i.kt)("inlineCode",{parentName:"p"},"https://audius.co"),"!"))),(0,i.kt)("h3",{id:"3-verify-the-response"},"3. Verify the response"),(0,i.kt)("p",null,"Extract the JWT (",(0,i.kt)("inlineCode",{parentName:"p"},"token"),") from the URI fragment or query string (if you used a redirect) or the event message (if you used ",(0,i.kt)("inlineCode",{parentName:"p"},"postmessage"),")."),(0,i.kt)("p",null,"Once you have the token, you must send it to the Audius ",(0,i.kt)("inlineCode",{parentName:"p"},"verify_token")," endpoint in order to verify that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the signature was signed by the Audius user who completed the authentication"),(0,i.kt)("li",{parentName:"ul"},"the content of the token hasn't been tampered with")),(0,i.kt)("p",null,"Upon verifying the validity of the JWT, the endpoint will return the authenticated user's decoded profile information."),(0,i.kt)("u",null,"GET /v1/users/verify_token?token=[JWT]"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Params")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"token ",(0,i.kt)("inlineCode",{parentName:"li"},"string")," - the JWT from the authentication flow that you would like to verify")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Sending the request")),(0,i.kt)("p",null,"To use the API, you first select an API endpoint from the list of endpoints returned by:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"GET https://api.audius.co")),(0,i.kt)("p",null,"Once you've selected a host, all API requests can be sent directly to it. For instance, if you picked the host at\n",(0,i.kt)("inlineCode",{parentName:"p"},"https://audius-dp.singapore.creatorseed.com"),", you would send the GET request to ",(0,i.kt)("inlineCode",{parentName:"p"},"https://audius-dp.singapore.creatorseed.com/v1/users/verify_token?token=<JWT>"),", where ",(0,i.kt)("inlineCode",{parentName:"p"},"<JWT>")," is replaced with the JWT you retrieved in the auth flow."),(0,i.kt)("p",null,"We recommend selecting a host each time your application starts up as availability may change over time."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Success response")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Code: 200 OK"),(0,i.kt)("li",{parentName:"ul"},"Content: The decoded JWT payload, which contains the user's profile information:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},'{\n  userId: number, // unique Audius user identifier\n  email: string,\n  name: string, // user\'s display name\n  handle: string,\n  verified: boolean, // whether the user has the Audius "verified" checkmark\n  profilePicture: {"150x150": string, "480x480": string, "1000x1000": string } | null // URLs for the user\'s profile picture\n  sub: number, // alias for userId\n  iat: string, // timestamp for when auth was performed\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Error responses")),(0,i.kt)("ins",null,"Invalid signature"),":",(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Code: ",(0,i.kt)("inlineCode",{parentName:"li"},"404")," Not Found"),(0,i.kt)("li",{parentName:"ul"},'Content: Error message describing the issue that occurred, e.g. "The JWT signature is invalid - wallet could not be recovered."')),(0,i.kt)("ins",null,"Problem with `token` input"),":",(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Code: ",(0,i.kt)("inlineCode",{parentName:"li"},"400")," Bad Request"),(0,i.kt)("li",{parentName:"ul"},'Content: Error message, e.g. "the JWT signature could not be decoded."')),(0,i.kt)("h4",{id:"3-done"},"3. Done!"),(0,i.kt)("p",null,"Once you've verified the JWT, the authentication flow is complete and you now have your user's Audius profile information."),(0,i.kt)("h4",{id:"a-quick-note-on-email"},(0,i.kt)("a",{parentName:"h4",href:"#retrieving-email-addresses"},"A quick note on email")))}d.isMDXComponent=!0}}]);