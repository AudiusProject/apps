services:
  filebeat:
    build: 
      context: filebeat
      args:
          - ELASTIC_ENDPOINT=${ELASTIC_ENDPOINT}
          - ELASTIC_USER=${ELASTIC_USER}
          - ELASTIC_PASS=${ELASTIC_PASS}
    container_name: filebeat
    hostname: "{{.Node.Hostname}}-filebeat"
    user: root
    restart: always
    volumes:
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/run/docker.sock:/var/run/docker.sock:ro
      # for system and auth modules
      - /var/log/:/var/log/:ro

  metricbeat:
    build: metricbeat
    container_name: metricbeat
    hostname: "{{.Node.Hostname}}-metricbeat"
    user: root
    restart: always
    environment:
      - ELASTIC_ENDPOINT=${ELASTIC_ENDPOINT}
      - ELASTIC_CLOUD_ID=${ELASTIC_CLOUD_ID}
      - ELASTIC_USER=${ELASTIC_USER}
      - ELASTIC_PASS=${ELASTIC_PASS}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro

  logspout:
    image: gliderlabs/logspout:v3.2.14
    container_name: logspout
    environment:
      - SYSLOG_STRUCTURED_DATA=${LOGGLY_TOKEN}@41058 tag="logspout"
      - BACKLOG=false
    command: multiline+syslog+tcp://logs-01.loggly.com:514
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
s
