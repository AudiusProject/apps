filebeat.config:
  modules:
    path: ${path.config}/modules.d/*.yml
    reload.enabled: false

filebeat.inputs:
- type: log
  paths:
    - "/var/lib/docker/containers/*/*.log"
  json.message_key: log
  json.keys_under_root: true
  processors:
  - add_docker_metadata: ~
  # fields:
  #   app_id: query_engine_12

filebeat.autodiscover:
  providers:
    - type: docker
      hints.enabled: true

# processors:
#   # decode the log field (sub JSON document) if JSON encoded, then maps it's fields to elasticsearch fields
#   - decode_json_fields:
#     fields: ["log", "message"]
#     process_array: false
#     max_depth: 3
#     target: ""
#     # overwrite existing target elasticsearch fields while decoding json fields
#     overwrite_keys: true
#   # - add_docker_metadata:
#   #     host: "unix:///var/run/docker.sock"
#   - rename:
#       fields:
#       - from: "host"
#         to: "host.name"
processors:
  - decode_json_fields:
      fields: ["log", "message"]
      process_array: false
      max_depth: 3
      target: ""
      overwrite_keys: true
  - rename:
      fields:
      - from: "service"
        to: "service.name"
  - drop_fields:
      fields: ["host"]

output.elasticsearch:
  hosts: '${ELASTIC_ENDPOINT}'
  username: '${ELASTIC_USER}'
  password: '${ELASTIC_PASS}'
