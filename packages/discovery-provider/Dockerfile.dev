# Pretty much the same as the Dockerfile.prod but assumes the whole
# discovery-provider package is a mounted volume instead of copying everything.
FROM audius/discovery-provider-base:latest

# ARGs can be optionally defined with --build-arg while doing docker build eg in CI and then set to env vars
ARG git_sha
ENV GIT_SHA=$git_sha

EXPOSE 5000

HEALTHCHECK --interval=5s --timeout=10s --retries=12 \
  CMD pgrep pg_migrate || curl -f http://localhost:5000/health_check || exit 1

CMD ["bash", "scripts/start.sh"]

